---
title: Vue 初体验
date: 2017-02-22 14:06:38
tags: vue
categories: front-end
---

> 项目地址：https://github.com/xandeer/gank
> 预览地址：[![](/images/gank-qrcode.png)](http://xandeer.me/gank)

## 写这篇文章的原因

昨天完成了我的第一个开源项目的基础功能，也是对 `Vue` 第一次尝试的一次总结。

## 开始项目缘由

第一个原因，成果展示。因为去年任性地裸辞了，前前后后学习前端时间了，余粮快没有了，是时候重新寻找
一份工作了，而之前又没有前端方面的作品，所以就当这个项目是自己寻找工作时可以一说的成果。

第二个原因，看完文档该实践了。去年辞职前就开始学习前端知识了，关注了几个个人认为还不错的前端公众
号，之前就有每天刷开发者头条和掘金的习惯，把之前关注后台的注意力转向了前端。自然，`React` 和
`Vue` 会经常出现，只是刚开始关注时前端知识量太薄弱，不适合一上来就跳过基础直接使用框架。年底时
认为差不多该了解学习框架了，在两者（`Angular` 不怎么了解）里面选择了 `Vue`，为什么选择 `Vue`
？（要跑题了）这个暂时就不说了，我记着在掘金上看过一篇忽悠大家使用 `Vue` 的译文。然后过年的那
几天，掌控自己的时间还是挺难的，不能每天码代码，就抽空每天看看 `Vue` 的文档，看完后有空也会简单
尝试一下。半个月前将教程全都过了一遍，有不少概念没有搞清楚，需要实践出真知了。

## 项目时间线

### 做什么？

首先，确定自己要做什么。因为每天都刷开发者头条和掘金，觉着这两个应用都不错（我不是做广告的），就
决定尝试做个类似的内容呈现应用。做这个决定的时间不算在总时间内。

既然要做内容呈现应用，内容从哪里来？平常的积累和各种搜索引擎，平常的积累指的是平常阅读技术类文章
时，长年累月收藏的素材；各种搜索引擎指谷歌、Stack Overflow、github 和知乎等。这个过程花费了
近一天，从知乎日报、CNode、v2ex、hacker news 和 gank.io 中选择了最后一个。

确定做什么与寻找 api 总花费1天。

### 基本功能

之前只是看了 `Vue` 的教程文档，没有了解过 `vue-router` 和`vuex`，在做的时候边做边学。用了
`mint-ui`，一个用于 `Vue` 的 UI 库，大概浏览了一下文档，需要什么再具体看。还用了强大的
`swiper3`，在 github 上找到了 `vue` 的适配，也是先浏览了文档，再根据需要具体学习，在这个库
上被坑的挺惨，后文会具体说明，但确实非常强大。

主要基于以上技术，花了6天实现了基本功能（存在一些可见的不影响功能，但影响视觉效果的 bugs）。

### fix bugs

#### 使用 Swiper

我用了 `swiper` 实现首页的滑动切换效果，因为同时也要支持点击导航切换，因此使用了自定义的
`pagination`。问题就出在这里了，我还做了主题色的切换，因此切换主题色时，当前活动的导航条要与
主题色同色，而 `pagination` 是由 `swiper` 控制的，所以就在首页挂载的时候找到相应的元素修改
颜色。slider 切换后也要更改当前活动导航的颜色，我就去看 `swiper` 的文档，在里面找到了
slider 切换时会触发 `onSlideChangeStart` 事件。我以为问题就这样解决了，然而有一天手一贱，
将 Chrome 的手机模式点掉了，然后上面的现象突然又出现在了我面前（想哭了都）。然后就来回切换了一
下，想想这个时候发生了什么，原来是浏览器窗口大小发生了变化，`swiper` 需要重新绘制
`pagination`。怎么办，虽然用户很少会触发这个现象，但是他们横竖屏切换时也会发生啊，想到的最简单
的方法就是给 `window` 添加一个 `resize` 事件，然后我就这么做了。后来想想，这么做有点不爽，
既然已经依赖了 `swiper`，还要自己监听 `window` 的`resize` 事件，`swiper` 肯定已经做过了。
然后在控制台看了一下 `window` 的 `resize` 事件，果然有一个 `swiper` 在监听 `resize` 事
件。怎么处理呢？去看文档，发现有一个 `onPaginationRendered` 事件，问题又一次解决了。

在此，深深地感谢 `swiper` 源码贡献者和文档译者。

#### 保存页面位置

一开始，认为这个很简单就做到了，开始也确实是这样发展的，直到有一天又犯贱注释了一行代码。注释完，
当时没有发现这个问题，有一天晚上好像是在解决 `swiper` 的问题时，突然发现怎么跳转页面，再回来不
是之前的位置了。我还以为出现幻觉了，当时没管，接着处理 `swiper` 问题，第二天再确定了一下，保存
位置确实没有生效。看了看 `vue` 开发者工具，跳转页面时确实会更新之前页面的位置，但每次都是0。在
`beforeDestroy` 事件中打印滚动的元素，可以获取到，但打印元素的 `scrollTop` 值每次都返回0。
使用谷歌没有找到解决方案，就想了想，为什么之前是好用的？再想想，应该和 `vue` 的生命周期有关系，
之前哪个改动会影响 `vue` 的生命周期呢？然后想起来我之前注释掉的那行代码是 `router-view` 上面
的 `transition` 组件，在动画效果完成前，页面肯定是存在的，然后取消掉那行注释试了试，果然好了。
但是，已然没有想明白，在 `beforeDestroy` 中获取到的 `scrollTop` 值为什么总是0（有明白的大
神烦请告诉我一下 kkxandeer@gmail.com）？

修复 bug 大概花了2天左右。

### 美化

做了一个切换主题色的小功能，一开始先完成功能，做得比较丑，罗列了一堆颜色条在页面上。后来花了半天
时间，做成了一个圆盘形的拾色器的样子。一下子好看多了，拿出手机试了试，在 iOS 上点击时会把后面隐
藏起来的部分闪现出来一下，最后在 Stack Overflow 上找到了答案，
`-webkit-tap-highlight-color: transparent;`。

![gank-themes](/images/gank-themes.png)

花了一早上搞定了这个。

初步完成此项目总计花费10天。

## 感想

知识需要经过刻意练习才会转化为能力，每个有坑的地方，也就是要成长的地方。前几天在 Medium 上看到
一句话：

> I fail all the time, I just don't give up.

## 最后

`Vue` 确实非常好用，非常值得入手。

放个广告：[本人简历](https://github.com/xandeer/resume)，希望早日被人捡走。

感谢开源！
